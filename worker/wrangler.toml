name = "shinel-auth"
main = "worker.js"
compatibility_date = "2025-09-01"
compatibility_flags = ["nodejs_compat"]
workers_dev = true

# Replace this with your actual account id from `wrangler whoami`
account_id = "ef97dba03debca21252fabdfee85d006"

# --- KV Namespaces ---
# ✅ KV for thumbnails storage
[[kv_namespaces]]
binding = "THUMBNAILS"
id = "4568299114a9458dabca40cb7d34b506"

# ✅ KV for video view cache
[[kv_namespaces]]
binding = "VIDEO_VIEWS"
id = "8df49ad0a82f475994a88ce4d9872c62"

# ✅ KV for users (if used for auth)
[[kv_namespaces]]
binding = "SHINEL_USERS"
id = "b591c0b101c94327bf80c53e639eb779"

# ✅ KV for audit logs / global data (used by thumbnails & videos)
[[kv_namespaces]]
binding = "SHINEL_AUDIT"
id = "d066d3e9d7d94153a263067a8204ca9e"          # existing PROD KV
preview_id = "3cbcd4fa6bb448789ca40ec2c42658dd"   # new PREVIEW KV

# ✅ Optional additional namespace (if your auth worker references it)
[[kv_namespaces]]
binding = "SHINEL_USERS_PROD"
id = "f97b96f897114a559bce369f79ec80f2"

# --- D1 Database ---
[[d1_databases]]
binding = "DB"
database_name = "shinel-db"
database_id = "907df36d-0254-4744-8473-bcfcc4aa8e0c"

# --- Cron Triggers ---
[triggers]
crons = ["*/30 * * * *"] # Every 30 mins

# Note: Secrets (JWT_SECRET, USERS_JSON, YOUTUBE_API_KEYS) are stored separately via:
# wrangler secret put JWT_SECRET
# wrangler secret put USERS_JSON
# wrangler secret put YOUTUBE_API_KEYS  # Can be a comma-separated list for pooling
